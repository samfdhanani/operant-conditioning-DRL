import os
import pandas as pd
import numpy as np
from statistics import mean
import matplotlib.pyplot as plt

# Load the CSV file generated by the previous code
averages_filepath = "/Users/samdhanani/Desktop/MuhleLab/Operant_Data_Folders/CohF_DRHburst2-3s_030724.csv"  # Replace with the actual file path
averages_df = pd.read_csv(averages_filepath)

# List of columns to calculate averages for
columns_to_average = ['number of bursts', 'sum of all bursts', 'average burst time','average_burst_press_count']

# Convert columns to numeric and remove brackets for the relevant columns
for column in columns_to_average:
    if averages_df[column].dtype == 'object':
        averages_df[column] = averages_df[column].str.replace(r'[^0-9.]', '', regex=True)
        averages_df[column] = pd.to_numeric(averages_df[column], errors='coerce')

# Extract the program number and store it in a new column
averages_df['Program'] = averages_df['Program'].str.extract('(\d+)')
averages_df['Program'] = pd.to_numeric(averages_df['Program'], errors='coerce')


# Extract the year from the 'Date' column
# averages_df['Year'] = pd.to_datetime(averages_df['Date']).dt.year

# Group the data by 'Year', 'Program Number', 'Subject', then calculate the averages
#grouped_averages_df = averages_df.groupby(['Year', 'Program Number', 'Subject'])[columns_to_average].mean().reset_index()
grouped_averages_df = averages_df.groupby(['Program', 'Subject', 'Genotype', 'Sex'])[
    columns_to_average + ['Date']
].agg({'Date': 'first', **{col: 'mean' for col in columns_to_average}}).reset_index()

# Define the desired output CSV file path and name
output_csv_filepath = "/Users/samdhanani/Desktop/MuhleLab/Operant_Data_Folders/CohF_DRH_AVGburst2-3s_030724.csv"

# Save the grouped_averages_df DataFrame to the new CSV file
grouped_averages_df.to_csv(output_csv_filepath, index=False)

# Print or further analyze the 'grouped_averages_df' DataFrame as needed
print(grouped_averages_df)
